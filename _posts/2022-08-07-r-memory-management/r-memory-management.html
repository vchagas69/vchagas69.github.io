<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>


  <!--radix_placeholder_meta_tags-->
  <title>R memory management</title>

  <meta property="description" itemprop="description" content="In this post we present a classic finance use case using the PerformanceAnalytics, quantmod, and dygraphs packages. We&#39;ll demonstrate importing stock data, building a portfolio, and then calculating the Sharpe Ratio."/>


  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2022-08-07"/>
  <meta property="article:created" itemprop="dateCreated" content="2022-08-07"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="R memory management"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="In this post we present a classic finance use case using the PerformanceAnalytics, quantmod, and dygraphs packages. We&#39;ll demonstrate importing stock data, building a portfolio, and then calculating the Sharpe Ratio."/>
  <meta property="og:locale" content="en_US"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="R memory management"/>
  <meta property="twitter:description" content="In this post we present a classic finance use case using the PerformanceAnalytics, quantmod, and dygraphs packages. We&#39;ll demonstrate importing stock data, building a portfolio, and then calculating the Sharpe Ratio."/>

  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","preview","date","categories","output","repository_url"]}},"value":[{"type":"character","attributes":{},"value":["R memory management"]},{"type":"character","attributes":{},"value":["In this post we present a classic finance use case using the PerformanceAnalytics, quantmod, and dygraphs packages. We'll demonstrate importing stock data, building a portfolio, and then calculating the Sharpe Ratio. \n"]},{"type":"character","attributes":{},"value":["preview.png"]},{"type":"character","attributes":{},"value":["08-07-2022"]},{"type":"character","attributes":{},"value":["portfolio theory","dygraphs"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["highlight","self_contained","toc"]}},"value":[{"type":"character","attributes":{},"value":["default"]},{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]}]}]},{"type":"character","attributes":{},"value":["https://github.com/jjallaire/reproducible-finance-with-r/"]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["preview.png","r-memory-management_files/anchor-4.2.2/anchor.min.js","r-memory-management_files/bowser-1.9.3/bowser.min.js","r-memory-management_files/distill-2.2.21/template.v2.js","r-memory-management_files/dygraphs-1.1.1/dygraph-combined-dev.js","r-memory-management_files/dygraphs-1.1.1/dygraph-combined.js","r-memory-management_files/dygraphs-1.1.1/dygraph.css","r-memory-management_files/dygraphs-1.1.1/shapes.js","r-memory-management_files/dygraphs-binding-1.1.1.6/dygraphs.js","r-memory-management_files/header-attrs-2.14/header-attrs.js","r-memory-management_files/htmlwidgets-1.5.4/htmlwidgets.js","r-memory-management_files/jquery-3.6.0/jquery-3.6.0.js","r-memory-management_files/jquery-3.6.0/jquery-3.6.0.min.js","r-memory-management_files/jquery-3.6.0/jquery-3.6.0.min.map","r-memory-management_files/moment-2.8.4/moment.js","r-memory-management_files/moment-2.8.4/moment-timezone-with-data.js","r-memory-management_files/moment-fquarter-1.0.0/moment-fquarter.min.js","r-memory-management_files/moment-timezone-0.2.5/moment.js","r-memory-management_files/moment-timezone-0.2.5/moment-timezone-with-data.js","r-memory-management_files/popper-2.6.0/popper.min.js","r-memory-management_files/tippy-6.2.7/tippy-bundle.umd.min.js","r-memory-management_files/tippy-6.2.7/tippy.css","r-memory-management_files/tippy-6.2.7/tippy-light-border.css","r-memory-management_files/tippy-6.2.7/tippy.umd.min.js","r-memory-management_files/webcomponents-2.0.0/webcomponents.js","sharpe-ratio_files/anchor-4.2.2/anchor.min.js","sharpe-ratio_files/bowser-1.9.3/bowser.min.js","sharpe-ratio_files/distill-2.2.21/template.v2.js","sharpe-ratio_files/dygraphs-1.1.1/dygraph-combined-dev.js","sharpe-ratio_files/dygraphs-1.1.1/dygraph-combined.js","sharpe-ratio_files/dygraphs-1.1.1/dygraph.css","sharpe-ratio_files/dygraphs-1.1.1/shapes.js","sharpe-ratio_files/dygraphs-binding-1.1.1.6/dygraphs.js","sharpe-ratio_files/header-attrs-2.3/header-attrs.js","sharpe-ratio_files/htmlwidgets-1.5.1/htmlwidgets.js","sharpe-ratio_files/htmlwidgets-1.5.3/htmlwidgets.js","sharpe-ratio_files/jquery-1.11.3/jquery.min.js","sharpe-ratio_files/moment-2.8.4/moment.js","sharpe-ratio_files/moment-2.8.4/moment-timezone-with-data.js","sharpe-ratio_files/moment-fquarter-1.0.0/moment-fquarter.min.js","sharpe-ratio_files/moment-timezone-0.2.5/moment.js","sharpe-ratio_files/moment-timezone-0.2.5/moment-timezone-with-data.js","sharpe-ratio_files/popper-2.6.0/popper.min.js","sharpe-ratio_files/tippy-6.2.7/tippy-bundle.umd.min.js","sharpe-ratio_files/tippy-6.2.7/tippy.css","sharpe-ratio_files/tippy-6.2.7/tippy-light-border.css","sharpe-ratio_files/tippy-6.2.7/tippy.umd.min.js","sharpe-ratio_files/webcomponents-2.0.0/webcomponents.js"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        if ($(this).children()[0].nodeName == "D-FOOTNOTE") {
          var fn = $(this).children()[0]
          $(this).html(fn.shadowRoot.querySelector("sup"))
          $(this).id = fn.id
          fn.remove()
        }
        var refs = $(this).attr('data-cites').split(" ");
        var refHtml = refs.map(function(ref) {
          return "<p>" + $('#ref-' + ref).html() + "</p>";
        }).join("\n");
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // fix footnotes in tables (#411)
      // replacing broken distill.pub feature
      $('table d-footnote').each(function() {
        // we replace internal showAtNode methode which is triggered when hovering a footnote
        this.hoverBox.showAtNode = function(node) {
          // ported from https://github.com/distillpub/template/pull/105/files
          calcOffset = function(elem) {
              let x = elem.offsetLeft;
              let y = elem.offsetTop;
              // Traverse upwards until an `absolute` element is found or `elem`
              // becomes null.
              while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                  x += elem.offsetLeft;
                  y += elem.offsetTop;
              }

              return { left: x, top: y };
          }
          // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
          const bbox = node.getBoundingClientRect();
          const offset = calcOffset(node);
          this.show([offset.left + bbox.width, offset.top + bbox.height]);
        }
      })

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      // ignore leaflet img layers (#106)
      figures = figures.filter(':not(img[class*="leaflet"])')
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <!--/radix_placeholder_distill-->
  <script src="r-memory-management_files/header-attrs-2.14/header-attrs.js"></script>
  <script src="r-memory-management_files/htmlwidgets-1.5.4/htmlwidgets.js"></script>
  <script src="r-memory-management_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <link href="r-memory-management_files/dygraphs-1.1.1/dygraph.css" rel="stylesheet" />
  <script src="r-memory-management_files/dygraphs-1.1.1/dygraph-combined.js"></script>
  <script src="r-memory-management_files/dygraphs-1.1.1/shapes.js"></script>
  <script src="r-memory-management_files/moment-2.8.4/moment.js"></script>
  <script src="r-memory-management_files/moment-timezone-0.2.5/moment-timezone-with-data.js"></script>
  <script src="r-memory-management_files/moment-fquarter-1.0.0/moment-fquarter.min.js"></script>
  <script src="r-memory-management_files/dygraphs-binding-1.1.1.6/dygraphs.js"></script>
  <script src="r-memory-management_files/popper-2.6.0/popper.min.js"></script>
  <link href="r-memory-management_files/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="r-memory-management_files/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="r-memory-management_files/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="r-memory-management_files/anchor-4.2.2/anchor.min.js"></script>
  <script src="r-memory-management_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="r-memory-management_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="r-memory-management_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"R memory management","description":"In this post we present a classic finance use case using the PerformanceAnalytics, quantmod, and dygraphs packages. We'll demonstrate importing stock data, building a portfolio, and then calculating the Sharpe Ratio.","authors":[],"publishedDate":"2022-08-07T00:00:00.000+01:00"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>R memory management</h1>
<!--radix_placeholder_categories-->
<div class="dt-tags">
<div class="dt-tag">portfolio theory</div>
<div class="dt-tag">dygraphs</div>
</div>
<!--/radix_placeholder_categories-->
<p><p>In this post we present a classic finance use case using the
PerformanceAnalytics, quantmod, and dygraphs packages. We’ll demonstrate
importing stock data, building a portfolio, and then calculating the
Sharpe Ratio.</p></p>
</div>


<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#setting-up">Setting up</a></li>
<li><a href="#preparing-the-data">Preparing the data</a></li>
<li><a href="#calculating-portfolio-returns">Calculating portfolio
returns</a></li>
<li><a href="#calculating-the-sharpe-ratio">Calculating the Sharpe
Ratio</a></li>
</ul>
</nav>
</div>
<h2 id="overview">Overview</h2>
<p>In this post we’ll demonstrate the calculation of a Sharpe Ratio for
a stock portfolio. We’ll start with a function that grabs monthly stock
returns and saves those monthly returns as an xts object in the global
environment. With that function, we will create three xts objects of
monthly returns, and merge those three xts objects into one object,
before passing that merged object to dygraphs to peek at the individual
stocks.</p>
<p>Then, we’ll move on to build a portfolio by selecting asset weights
and calculating the portfolio monthly returns. Next, we will calculate
the growth of a dollar invested in that portfolio (which is what matters
to us) over time, and save the results to an xts object. Dygraphs will
come in handy again for the portfolio visualizations. Finally, we will
calculate the Sharpe Ratio.</p>
<h2 id="setting-up">Setting up</h2>
<p>We start by loading three packages: quantmod to download the data,
PerformanceAnalytics to run portfolio calculations, and dygraphs to
graph time series objects. We will also create a function to import
stock data.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/braverock/PerformanceAnalytics'>PerformanceAnalytics</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://www.quantmod.com'>quantmod</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/rstudio/dygraphs'>dygraphs</a></span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Function to calculate monthly returns on a stock </span></span>
<span><span class='va'>monthly_stock_returns</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>ticker</span>, <span class='va'>start_year</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>  </span>
<span>  <span class='co'># Download the data from Yahoo finance</span></span>
<span>  <span class='va'>symbol</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/quantmod/man/getSymbols.html'>getSymbols</a></span><span class='op'>(</span><span class='va'>ticker</span>, src <span class='op'>=</span> <span class='st'>'yahoo'</span>, </span>
<span>                       auto.assign <span class='op'>=</span> <span class='cn'>FALSE</span>, warnings <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span></span>
<span>  </span>
<span>  <span class='co'># Tranform it to monthly returns using quantmode::periodReturn</span></span>
<span>  <span class='va'>data</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/quantmod/man/periodReturn.html'>periodReturn</a></span><span class='op'>(</span><span class='va'>symbol</span>, period <span class='op'>=</span> <span class='st'>'monthly'</span>, </span>
<span>                       subset<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='va'>start_year</span>, <span class='st'>"::"</span>, sep <span class='op'>=</span> <span class='st'>""</span><span class='op'>)</span>,</span>
<span>                       type <span class='op'>=</span> <span class='st'>'log'</span><span class='op'>)</span></span>
<span></span>
<span>  <span class='co'># Let's rename the column of returns to something intuitive because</span></span>
<span>  <span class='co'># the column name is what will eventually be displayed</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>data</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='va'>ticker</span><span class='op'>)</span></span>
<span></span>
<span>  <span class='co'># We want to be able to work with the xts objects so let's explicitly</span></span>
<span>  <span class='co'># assign them into the global environment using ticker name </span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/assign.html'>assign</a></span><span class='op'>(</span><span class='va'>ticker</span>, <span class='va'>data</span>, <span class='va'>.GlobalEnv</span><span class='op'>)</span></span>
<span><span class='op'>}</span></span></code></pre>
</div>
</div>
<p>The <code>monthly_stock_returns</code> function above takes 2
parameters, a stock symbol and a year. Note that we could have included
a third parameter called something like ‘period’ if we wanted the
ability to grab periods other than monthly returns. For example, we can
envision a desire to look at annual, weekly or daily returns. Here, I
force monthly returns because I don’t want to allow different period
options. It’s a choice driven by the purpose of this Notebook - which
here is focused on monthly returns.</p>
<h2 id="preparing-the-data">Preparing the data</h2>
<p>In the next chunk, we choose three stock tickers and a starting year
argument for the <code>monthly_stock_returns</code> function. Then, we
merge them into one xts object.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Choose the starting year and assign it to the 'year' variable</span></span>
<span><span class='va'>year</span> <span class='op'>&lt;-</span> <span class='fl'>2010</span></span>
<span></span>
<span><span class='co'># Use the function the monthly returns on 3 stocks, and pass in the 'year'</span></span>
<span><span class='co'># value. Let's choose Google, JP Morgan and Amazon</span></span>
<span><span class='fu'>monthly_stock_returns</span><span class='op'>(</span><span class='st'>'GOOG'</span>, <span class='va'>year</span><span class='op'>)</span></span>
<span><span class='fu'>monthly_stock_returns</span><span class='op'>(</span><span class='st'>'JPM'</span>, <span class='va'>year</span><span class='op'>)</span></span>
<span><span class='fu'>monthly_stock_returns</span><span class='op'>(</span><span class='st'>'AMZN'</span>, <span class='va'>year</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Merge the 3 monthly return xts objects into 1 xts object.</span></span>
<span><span class='va'>merged_returns</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/xts/man/merge.html'>merge.xts</a></span><span class='op'>(</span><span class='va'>GOOG</span>, <span class='va'>JPM</span>, <span class='va'>AMZN</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>Let’s graph the individual performances of each stock over time.</p>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Before we combine these into a portfolio, graph the individual returns</span></span>
<span><span class='co'># and see if anything jumps out as unusual. It looks like something </span></span>
<span><span class='co'># affected Google in March of 2014, but didn't affect JP Morgan or Amazon.</span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/dygraphs/man/dygraph.html'>dygraph</a></span><span class='op'>(</span><span class='va'>merged_returns</span>, main <span class='op'>=</span> <span class='st'>"Google v JP Morgan v Amazon"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/dygraphs/man/dyAxis.html'>dyAxis</a></span><span class='op'>(</span><span class='st'>"y"</span>, label <span class='op'>=</span> <span class='st'>"%"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/dygraphs/man/dyOptions.html'>dyOptions</a></span><span class='op'>(</span>colors <span class='op'>=</span> <span class='fu'>RColorBrewer</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html'>brewer.pal</a></span><span class='op'>(</span><span class='fl'>3</span>, <span class='st'>"Set2"</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
<div id="htmlwidget-30e4409849e39179307f" style="width:624px;height:384px;" class="dygraphs html-widget"></div>
<script type="application/json" data-for="htmlwidget-30e4409849e39179307f">{"x":{"attrs":{"axes":{"x":{"pixelsPerLabel":60,"drawAxis":true},"y":{"drawAxis":true}},"title":"Google v JP Morgan v Amazon","labels":["month","GOOG","JPM","AMZN"],"legend":"auto","retainDateWindow":false,"ylabel":"%","stackedGraph":false,"fillGraph":false,"fillAlpha":0.15,"stepPlot":false,"drawPoints":false,"pointSize":1,"drawGapEdgePoints":false,"connectSeparatedPoints":false,"strokeWidth":1,"strokeBorderColor":"white","colors":["#66C2A5","#FC8D62","#8DA0CB"],"colorValue":0.5,"colorSaturation":1,"includeZero":false,"drawAxesAtZero":false,"logscale":false,"axisTickSize":3,"axisLineColor":"black","axisLineWidth":0.3,"axisLabelColor":"black","axisLabelFontSize":14,"axisLabelWidth":60,"drawGrid":true,"gridLineWidth":0.3,"rightGap":5,"digitsAfterDecimal":2,"labelsKMB":false,"labelsKMG2":false,"labelsUTC":false,"maxNumberWidth":6,"animatedZooms":false,"mobileDisableYTouch":true,"disableZoom":false},"scale":"monthly","annotations":[],"shadings":[],"events":[],"format":"date","data":[["2010-01-29T00:00:00.000Z","2010-02-26T00:00:00.000Z","2010-03-31T00:00:00.000Z","2010-04-30T00:00:00.000Z","2010-05-28T00:00:00.000Z","2010-06-30T00:00:00.000Z","2010-07-30T00:00:00.000Z","2010-08-31T00:00:00.000Z","2010-09-30T00:00:00.000Z","2010-10-29T00:00:00.000Z","2010-11-30T00:00:00.000Z","2010-12-31T00:00:00.000Z","2011-01-31T00:00:00.000Z","2011-02-28T00:00:00.000Z","2011-03-31T00:00:00.000Z","2011-04-29T00:00:00.000Z","2011-05-31T00:00:00.000Z","2011-06-30T00:00:00.000Z","2011-07-29T00:00:00.000Z","2011-08-31T00:00:00.000Z","2011-09-30T00:00:00.000Z","2011-10-31T00:00:00.000Z","2011-11-30T00:00:00.000Z","2011-12-30T00:00:00.000Z","2012-01-31T00:00:00.000Z","2012-02-29T00:00:00.000Z","2012-03-30T00:00:00.000Z","2012-04-30T00:00:00.000Z","2012-05-31T00:00:00.000Z","2012-06-29T00:00:00.000Z","2012-07-31T00:00:00.000Z","2012-08-31T00:00:00.000Z","2012-09-28T00:00:00.000Z","2012-10-31T00:00:00.000Z","2012-11-30T00:00:00.000Z","2012-12-31T00:00:00.000Z","2013-01-31T00:00:00.000Z","2013-02-28T00:00:00.000Z","2013-03-28T00:00:00.000Z","2013-04-30T00:00:00.000Z","2013-05-31T00:00:00.000Z","2013-06-28T00:00:00.000Z","2013-07-31T00:00:00.000Z","2013-08-30T00:00:00.000Z","2013-09-30T00:00:00.000Z","2013-10-31T00:00:00.000Z","2013-11-29T00:00:00.000Z","2013-12-31T00:00:00.000Z","2014-01-31T00:00:00.000Z","2014-02-28T00:00:00.000Z","2014-03-31T00:00:00.000Z","2014-04-30T00:00:00.000Z","2014-05-30T00:00:00.000Z","2014-06-30T00:00:00.000Z","2014-07-31T00:00:00.000Z","2014-08-29T00:00:00.000Z","2014-09-30T00:00:00.000Z","2014-10-31T00:00:00.000Z","2014-11-28T00:00:00.000Z","2014-12-31T00:00:00.000Z","2015-01-30T00:00:00.000Z","2015-02-27T00:00:00.000Z","2015-03-31T00:00:00.000Z","2015-04-30T00:00:00.000Z","2015-05-29T00:00:00.000Z","2015-06-30T00:00:00.000Z","2015-07-31T00:00:00.000Z","2015-08-31T00:00:00.000Z","2015-09-30T00:00:00.000Z","2015-10-30T00:00:00.000Z","2015-11-30T00:00:00.000Z","2015-12-31T00:00:00.000Z","2016-01-29T00:00:00.000Z","2016-02-29T00:00:00.000Z","2016-03-31T00:00:00.000Z","2016-04-29T00:00:00.000Z","2016-05-31T00:00:00.000Z","2016-06-30T00:00:00.000Z","2016-07-29T00:00:00.000Z","2016-08-31T00:00:00.000Z","2016-09-30T00:00:00.000Z","2016-10-31T00:00:00.000Z","2016-11-30T00:00:00.000Z","2016-12-30T00:00:00.000Z","2017-01-31T00:00:00.000Z","2017-02-28T00:00:00.000Z","2017-03-31T00:00:00.000Z","2017-04-28T00:00:00.000Z","2017-05-31T00:00:00.000Z","2017-06-30T00:00:00.000Z","2017-07-31T00:00:00.000Z","2017-08-31T00:00:00.000Z","2017-09-29T00:00:00.000Z","2017-10-31T00:00:00.000Z","2017-11-30T00:00:00.000Z","2017-12-29T00:00:00.000Z","2018-01-31T00:00:00.000Z","2018-02-28T00:00:00.000Z","2018-03-29T00:00:00.000Z","2018-04-30T00:00:00.000Z","2018-05-31T00:00:00.000Z","2018-06-29T00:00:00.000Z","2018-07-31T00:00:00.000Z","2018-08-31T00:00:00.000Z","2018-09-28T00:00:00.000Z","2018-10-31T00:00:00.000Z","2018-11-30T00:00:00.000Z","2018-12-31T00:00:00.000Z","2019-01-31T00:00:00.000Z","2019-02-28T00:00:00.000Z","2019-03-29T00:00:00.000Z","2019-04-30T00:00:00.000Z","2019-05-31T00:00:00.000Z","2019-06-28T00:00:00.000Z","2019-07-31T00:00:00.000Z","2019-08-30T00:00:00.000Z","2019-09-30T00:00:00.000Z","2019-10-31T00:00:00.000Z","2019-11-29T00:00:00.000Z","2019-12-31T00:00:00.000Z","2020-01-31T00:00:00.000Z","2020-02-28T00:00:00.000Z","2020-03-31T00:00:00.000Z","2020-04-30T00:00:00.000Z","2020-05-29T00:00:00.000Z","2020-06-30T00:00:00.000Z","2020-07-31T00:00:00.000Z","2020-08-31T00:00:00.000Z","2020-09-30T00:00:00.000Z","2020-10-30T00:00:00.000Z","2020-11-30T00:00:00.000Z","2020-12-31T00:00:00.000Z","2021-01-29T00:00:00.000Z","2021-02-26T00:00:00.000Z","2021-03-31T00:00:00.000Z","2021-04-30T00:00:00.000Z","2021-05-28T00:00:00.000Z","2021-06-30T00:00:00.000Z","2021-07-30T00:00:00.000Z","2021-08-31T00:00:00.000Z","2021-09-30T00:00:00.000Z","2021-10-29T00:00:00.000Z","2021-11-30T00:00:00.000Z","2021-12-31T00:00:00.000Z","2022-01-31T00:00:00.000Z","2022-02-28T00:00:00.000Z","2022-03-31T00:00:00.000Z","2022-04-29T00:00:00.000Z","2022-05-31T00:00:00.000Z","2022-06-30T00:00:00.000Z","2022-07-29T00:00:00.000Z","2022-08-05T00:00:00.000Z"],[-0.156923411378267,-0.0059428331913417,0.0737499600635163,-0.0758401985628704,-0.0792837532430642,-0.0874850796720821,0.0858776423712418,-0.0745475041044506,0.15560983463544,0.154604314889377,-0.0992596162047033,0.0665822247489159,0.0107006989305771,0.02148773435169,-0.044401375600018,-0.075482794498419,-0.0281068006303358,-0.0437389080736493,0.175773481950698,-0.109715498009642,-0.0491007553615588,0.140342524795251,0.0113253500058594,0.074732160385048,-0.107426885154284,0.0636752055663897,0.0365108479303143,-0.0584233248418759,-0.0404707042279208,-0.00136096085073288,0.0872742119962695,0.0791272329077896,0.0965050517857434,-0.103521342143977,0.0262151084932054,0.0128189633339782,0.0660631831200871,0.0584793485810014,-0.0087878479388012,0.0375393196795601,0.0550324475769278,0.0104477555774157,0.00834789713863801,-0.0471074838152558,0.033680641826445,0.162613747709616,0.0277603002396592,0.0560803332719402,0.0523737789862688,0.0289427311603634,-0.086376125908421,-0.0559562157846735,0.06118519989178,0.0271165730906452,-0.00641753028625799,0,0.0100265966760047,-0.03217343156756,-0.031340258872327,-0.02889093250286,0.0153077538519063,0.0437064100528333,-0.0188002191476878,-0.0169024971960885,-0.00978088119037972,-0.0220411355569057,0.183918112015595,-0.0118342673565539,-0.0160274734469005,0.155539760018859,0.043752375701895,0.0216860934538927,-0.0212149413466274,-0.0627391852155571,0.0654275933137002,-0.0722726709209538,0.0598051264185079,-0.0611191305305239,0.105087370424684,-0.00226580990779975,0.0132614452822,0.00928412460936857,-0.0343614295576607,0.0180152075182415,0.0318397937739799,0.0326201761714554,0.00768413169205367,0.0880996911036193,0.062987858136029,-0.0599349707328021,0.0236740767087592,0.00944471480646212,0.0208389789499284,0.0582525579274621,0.00468091431469299,0.0241716956344431,0.111596797912403,-0.0573515384117192,-0.068305803240771,-0.0141135901126468,0.0643892024920248,0.0278664422650563,0.0871652022307093,0.000763735697997007,-0.0205011202271897,-0.102899192559267,0.0162678420237467,-0.0552430740168765,0.0750917623710546,0.00317485032227618,0.0465716129587216,0.0128463483158326,-0.07407045111041,-0.0208014126790243,0.118322521817637,-0.0237704621218471,0.0256754912575206,0.0331681677057314,0.0349733696782822,0.0242708226637321,0.0701849207680423,-0.0684586737335151,-0.141330001591208,0.148272019684869,0.057807408097029,-0.0107722406364024,0.0478934713557307,0.0971010185911508,-0.106150853743254,0.0980591036817719,0.0826848098778661,-0.00504468945548613,0.0467581828039094,0.103961723344214,0.0154771554247385,0.152789932475823,0.000597351978075402,0.0385416919397936,0.0760718619787286,0.0730045001403564,-0.0875715238700168,0.106694859545448,-0.0400331882598187,0.0155159060427975,-0.0640854510994107,-0.00596843834068894,0.0346686655875023,-0.194494982090078,-0.00810026895796424,-0.0417810349343601,0.0643327906993994,0.0134550441680691],[-0.0677594231746815,0.0749331269085229,0.0641363435488222,-0.0497067382851234,-0.0730607157307516,-0.0780025362579037,0.095533588577059,-0.102385746212117,0.0456945913302789,-0.0113622569624197,-0.00613087328346648,0.125949144092543,0.057708342516328,0.0382017430596914,-0.012717080946329,-0.0102474897639365,-0.0537993778302421,-0.0546584832173214,-0.0120408875807746,-0.0741269872622494,-0.220750244831906,0.143277806727567,-0.115448281163992,0.0710358054060645,0.114938532738255,0.0507033858254425,0.158509833669475,-0.0674716281206711,-0.25969211425067,0.0749478950716236,0.00752826642079159,0.0311755905433013,0.0861134959797987,0.0292133724659014,-0.0144999636992634,0.0679861721896497,0.0677032388419057,0.0389754251584931,-0.030299039998654,0.0321370881762147,0.107826397680209,-0.0335289180151601,0.0541968038029388,-0.0979514020678516,0.0226971203482526,-0.00290609523522141,0.104545280471746,0.021781310343152,-0.0548274860685252,0.0260310470530441,0.0662200362445498,-0.0811139285832842,-0.00735099679547753,0.0362262250094673,0.000867360645947188,0.0303985670104041,0.0132009767345203,0.00397611517910871,-0.00530505222969323,0.0394380905582436,-0.14044931260639,0.11945705152036,-0.011488670500511,0.0432883476486606,0.0390626392967743,0.0296562543010153,0.0112995111458456,-0.0668272582802071,-0.0500623764041423,0.0523997674540955,0.0371233341072642,-0.00979588882074462,-0.104132856510265,-0.0552817951679289,0.050564822175977,0.0650449774159643,0.0322281497086055,-0.0491425788119945,0.0290243512221665,0.0537133587841103,-0.0135732418250343,0.0393132117975222,0.1462817872569,0.0735643730011722,-0.019424949875453,0.0683861941106749,-0.0311580401203875,-0.00960881356929515,-0.0573612498255978,0.106698631512956,0.00436682996424063,-0.00996235717781431,0.0495810018584932,0.0520206912564674,0.0381267457064417,0.0228895362728906,0.0784733437940807,-0.0014707620548938,-0.0490629195456161,-0.0108801256142838,-0.0164051780731966,-0.0266102062002726,0.0981851245824074,-0.00322393867540182,-0.0153024357501124,-0.0344395265671245,0.019709143584139,-0.130158046511978,0.0584891915150154,0.00827485714531927,-0.0304512846045996,0.136625973325229,-0.0909595036050268,0.0536499325882847,0.0368786035517346,-0.0543833540893963,0.0688472288663998,0.0596194505212631,0.0533085315169692,0.0563654073632153,-0.0518219646762515,-0.130987464357127,-0.254395089238461,0.061702145122288,0.0160566561457605,-0.0339688830271471,0.0270598685849448,0.0360756793944208,-0.0399116906057247,0.0182188562323114,0.184291563560054,0.075070983296559,0.0125128559368169,0.134337395933035,0.0338041412088375,0.0103255526655305,0.0656107416932683,-0.0544259148916355,-0.0244707908750124,0.0524291502523822,0.0231131597348148,0.0371767555331811,-0.0673167024685184,-0.00302664956374669,-0.0635496382148879,-0.0468405374059232,-0.0394125208238159,-0.132860969597303,0.102398655484943,-0.160612269729269,0.0241271516160148,0.00346141739519851],[-0.0701245170361104,-0.0575196473860531,0.136893555162285,0.00974830895607885,-0.0887236038996716,-0.138256619701026,0.0760216233364645,0.0572008253589236,0.229675086283769,0.0507105447161708,0.0597306372751833,0.0258877709521278,-0.0592783062838204,0.0212879470457643,0.038712320783313,0.0834659888797685,0.00448408394656569,0.038890189269922,0.0844979106753692,-0.0333097614310046,0.00463543220971598,-0.0126589860065143,-0.104679020816794,-0.105135186980332,0.116254169995091,-0.0788904882388922,0.119556124104995,0.135516976218129,-0.0854367030564848,0.0700099984260068,0.0214456393963761,0.0621916846004308,0.0240764529747323,-0.0880270775168484,0.079061241442941,-0.00469260385489299,0.0566799640082468,-0.0046435328921796,0.00836541165990536,-0.0487507638424042,0.0588686421632577,0.0310507858109792,0.0813355112021505,-0.0695574023601972,0.106768876430912,0.152183912968598,0.0781496950722755,0.0130490358040339,-0.105976506999658,0.00946191107192804,-0.073708612739359,-0.100756562455393,0.0273092148009775,0.0383835736591202,-0.0369767888889539,0.0799468533720013,-0.0502010221045888,-0.0540982352731005,0.103118700010599,-0.0872368442932364,0.133092275766055,0.0697991954990793,-0.0214295287722197,0.125321263149126,0.0175090072958163,0.0112589800759107,0.211162124095718,-0.0443525737472462,-0.00195167801461809,0.201080855723373,0.0602956897790523,0.0165439780178915,-0.141005461899503,-0.0605352241941228,0.0717834457031911,0.105345388529898,0.0915002936695275,-0.00996947961354622,0.0586021200400729,0.0135476463192695,0.0848953858932999,-0.0583892994549821,-0.050972178844106,-0.000933059703533762,0.0936394045680431,0.0258446771062801,0.0479423059123367,0.0424566808834528,0.0725778079134703,-0.0271286059577572,0.0202278722890952,-0.007295392066529,-0.0198260413990336,0.139515408095836,0.0626577387549189,-0.00620579766775547,0.215626551187989,0.0415536372667673,-0.0440034785837488,0.0788802989883701,0.0397392491413005,0.0421636779262453,0.0446635758053424,0.124307903463559,-0.00483597616538385,-0.225887009053645,0.0560700361587406,-0.118051484037656,0.134808037916738,-0.0469930675149137,0.0824420112908899,0.0786806236115469,-0.0818753437216105,0.0646557723125364,-0.0142806642415888,-0.049688081106002,-0.0229951136498185,0.0232034025384439,0.0134958245591728,0.0257863460211839,0.0834803056896909,-0.064233202468867,0.0344213015635034,0.238150477196001,-0.012867370355306,0.121834129217877,0.137248898140247,0.0866005696665222,-0.0916533239121496,-0.0364089199841964,0.0425228234526659,0.0276719595264376,-0.0156985926725624,-0.0359675610998883,0.000371714295540387,0.113920237106323,-0.0730764729909035,0.0651836185681695,-0.0332696344123036,0.042133938300254,-0.0550034402304434,0.0262547660170161,0.0391473426873095,-0.0505062022965097,-0.108509809986994,0.0263230081439703,0.059623918668409,-0.271185680930755,-0.0333130911887435,-0.123817821958065,0.239486060315419,0.0424361477972024]],"fixedtz":false,"tzone":"UTC"},"evals":[],"jsHooks":[]}</script>
</div>
<p>Nothing earth-shattering thus far: we have an xts object of three
time series and have seen that one of them had weird behavior in April
of 2014 (a Google stock split). We’ll ignore that behavior for this
example and go on to constructing a portfolio.</p>
<h2 id="calculating-portfolio-returns">Calculating portfolio
returns</h2>
<p>Here we’ll find the monthly returns of a weighted combination of
assets. Unsurprisingly, we start out by choosing those weights.</p>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># We have the 3 monthly returns saved in 1 object.</span></span>
<span><span class='co'># Now, let's choose the respective weights of those 3.</span></span>
<span><span class='co'># Here we'll allocate 25% to Google, 25% to JP Morgan and 50% to Amazon.</span></span>
<span><span class='va'>w</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>.25</span>, <span class='fl'>.25</span>, <span class='fl'>.50</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Now use the built in PerformanceAnalytics function Return.portfolio</span></span>
<span><span class='co'># to calculate the monthly returns on the portfolio,</span></span>
<span><span class='va'>portfolio_monthly_returns</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/PerformanceAnalytics/man/Return.portfolio.html'>Return.portfolio</a></span><span class='op'>(</span><span class='va'>merged_returns</span>, weights <span class='op'>=</span> <span class='va'>w</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Use dygraphs to chart the portfolio monthly returns.</span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/dygraphs/man/dygraph.html'>dygraph</a></span><span class='op'>(</span><span class='va'>portfolio_monthly_returns</span>, main <span class='op'>=</span> <span class='st'>"Portfolio Monthly Return"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/dygraphs/man/dyAxis.html'>dyAxis</a></span><span class='op'>(</span><span class='st'>"y"</span>, label <span class='op'>=</span> <span class='st'>"%"</span><span class='op'>)</span></span></code></pre>
</div>
<div id="htmlwidget-2e17466358a46d139971" style="width:624px;height:384px;" class="dygraphs html-widget"></div>
<script type="application/json" data-for="htmlwidget-2e17466358a46d139971">{"x":{"attrs":{"axes":{"x":{"pixelsPerLabel":60},"y":[]},"title":"Portfolio Monthly Return","labels":["month","portfolio.returns"],"legend":"auto","retainDateWindow":false,"ylabel":"%"},"scale":"monthly","annotations":[],"shadings":[],"events":[],"format":"date","data":[["2010-01-29T00:00:00.000Z","2010-02-26T00:00:00.000Z","2010-03-31T00:00:00.000Z","2010-04-30T00:00:00.000Z","2010-05-28T00:00:00.000Z","2010-06-30T00:00:00.000Z","2010-07-30T00:00:00.000Z","2010-08-31T00:00:00.000Z","2010-09-30T00:00:00.000Z","2010-10-29T00:00:00.000Z","2010-11-30T00:00:00.000Z","2010-12-31T00:00:00.000Z","2011-01-31T00:00:00.000Z","2011-02-28T00:00:00.000Z","2011-03-31T00:00:00.000Z","2011-04-29T00:00:00.000Z","2011-05-31T00:00:00.000Z","2011-06-30T00:00:00.000Z","2011-07-29T00:00:00.000Z","2011-08-31T00:00:00.000Z","2011-09-30T00:00:00.000Z","2011-10-31T00:00:00.000Z","2011-11-30T00:00:00.000Z","2011-12-30T00:00:00.000Z","2012-01-31T00:00:00.000Z","2012-02-29T00:00:00.000Z","2012-03-30T00:00:00.000Z","2012-04-30T00:00:00.000Z","2012-05-31T00:00:00.000Z","2012-06-29T00:00:00.000Z","2012-07-31T00:00:00.000Z","2012-08-31T00:00:00.000Z","2012-09-28T00:00:00.000Z","2012-10-31T00:00:00.000Z","2012-11-30T00:00:00.000Z","2012-12-31T00:00:00.000Z","2013-01-31T00:00:00.000Z","2013-02-28T00:00:00.000Z","2013-03-28T00:00:00.000Z","2013-04-30T00:00:00.000Z","2013-05-31T00:00:00.000Z","2013-06-28T00:00:00.000Z","2013-07-31T00:00:00.000Z","2013-08-30T00:00:00.000Z","2013-09-30T00:00:00.000Z","2013-10-31T00:00:00.000Z","2013-11-29T00:00:00.000Z","2013-12-31T00:00:00.000Z","2014-01-31T00:00:00.000Z","2014-02-28T00:00:00.000Z","2014-03-31T00:00:00.000Z","2014-04-30T00:00:00.000Z","2014-05-30T00:00:00.000Z","2014-06-30T00:00:00.000Z","2014-07-31T00:00:00.000Z","2014-08-29T00:00:00.000Z","2014-09-30T00:00:00.000Z","2014-10-31T00:00:00.000Z","2014-11-28T00:00:00.000Z","2014-12-31T00:00:00.000Z","2015-01-30T00:00:00.000Z","2015-02-27T00:00:00.000Z","2015-03-31T00:00:00.000Z","2015-04-30T00:00:00.000Z","2015-05-29T00:00:00.000Z","2015-06-30T00:00:00.000Z","2015-07-31T00:00:00.000Z","2015-08-31T00:00:00.000Z","2015-09-30T00:00:00.000Z","2015-10-30T00:00:00.000Z","2015-11-30T00:00:00.000Z","2015-12-31T00:00:00.000Z","2016-01-29T00:00:00.000Z","2016-02-29T00:00:00.000Z","2016-03-31T00:00:00.000Z","2016-04-29T00:00:00.000Z","2016-05-31T00:00:00.000Z","2016-06-30T00:00:00.000Z","2016-07-29T00:00:00.000Z","2016-08-31T00:00:00.000Z","2016-09-30T00:00:00.000Z","2016-10-31T00:00:00.000Z","2016-11-30T00:00:00.000Z","2016-12-30T00:00:00.000Z","2017-01-31T00:00:00.000Z","2017-02-28T00:00:00.000Z","2017-03-31T00:00:00.000Z","2017-04-28T00:00:00.000Z","2017-05-31T00:00:00.000Z","2017-06-30T00:00:00.000Z","2017-07-31T00:00:00.000Z","2017-08-31T00:00:00.000Z","2017-09-29T00:00:00.000Z","2017-10-31T00:00:00.000Z","2017-11-30T00:00:00.000Z","2017-12-29T00:00:00.000Z","2018-01-31T00:00:00.000Z","2018-02-28T00:00:00.000Z","2018-03-29T00:00:00.000Z","2018-04-30T00:00:00.000Z","2018-05-31T00:00:00.000Z","2018-06-29T00:00:00.000Z","2018-07-31T00:00:00.000Z","2018-08-31T00:00:00.000Z","2018-09-28T00:00:00.000Z","2018-10-31T00:00:00.000Z","2018-11-30T00:00:00.000Z","2018-12-31T00:00:00.000Z","2019-01-31T00:00:00.000Z","2019-02-28T00:00:00.000Z","2019-03-29T00:00:00.000Z","2019-04-30T00:00:00.000Z","2019-05-31T00:00:00.000Z","2019-06-28T00:00:00.000Z","2019-07-31T00:00:00.000Z","2019-08-30T00:00:00.000Z","2019-09-30T00:00:00.000Z","2019-10-31T00:00:00.000Z","2019-11-29T00:00:00.000Z","2019-12-31T00:00:00.000Z","2020-01-31T00:00:00.000Z","2020-02-28T00:00:00.000Z","2020-03-31T00:00:00.000Z","2020-04-30T00:00:00.000Z","2020-05-29T00:00:00.000Z","2020-06-30T00:00:00.000Z","2020-07-31T00:00:00.000Z","2020-08-31T00:00:00.000Z","2020-09-30T00:00:00.000Z","2020-10-30T00:00:00.000Z","2020-11-30T00:00:00.000Z","2020-12-31T00:00:00.000Z","2021-01-29T00:00:00.000Z","2021-02-26T00:00:00.000Z","2021-03-31T00:00:00.000Z","2021-04-30T00:00:00.000Z","2021-05-28T00:00:00.000Z","2021-06-30T00:00:00.000Z","2021-07-30T00:00:00.000Z","2021-08-31T00:00:00.000Z","2021-09-30T00:00:00.000Z","2021-10-29T00:00:00.000Z","2021-11-30T00:00:00.000Z","2021-12-31T00:00:00.000Z","2022-01-31T00:00:00.000Z","2022-02-28T00:00:00.000Z","2022-03-31T00:00:00.000Z","2022-04-29T00:00:00.000Z","2022-05-31T00:00:00.000Z","2022-06-30T00:00:00.000Z","2022-07-29T00:00:00.000Z","2022-08-05T00:00:00.000Z"],[-0.0912329671562924,-0.0115889937532705,0.10187259616716,-0.0257205065524162,-0.0825732903358855,-0.111276335145317,0.0835846905093967,-0.016564595119905,0.167403009925052,0.0581283277255218,0.00974203925088091,0.0550499117740533,-0.0188609563008781,0.0254034971983359,0.00876468496344174,0.0295662602603768,-0.0146937836026291,0.00375938077686988,0.0797468476702625,-0.054988016291459,-0.0465181791153371,0.0372526596677141,-0.084639922445921,-0.0391892968819393,0.0639642914582124,-0.0265463554642226,0.109793933496264,0.0536178342929177,-0.11029970189594,0.0570805423040297,0.0311657650140909,0.0605941317687362,0.0475782217016212,-0.0727533209757772,0.0523284594229023,0.0105466424865979,0.0603897662238728,0.0151565590967484,-0.00197657919806327,-0.0174716308322773,0.0669496678861119,0.0145595701707451,0.0612484015047863,-0.0701793076637657,0.0773807237031148,0.128725481697601,0.0718764013912148,0.0226301371915927,-0.0668846266525245,0.0163337664338088,-0.0551912215344101,-0.0875452327944591,0.028972796989237,0.0353860961638015,-0.0235371408467063,0.052549122657453,-0.0260178244555643,-0.0388297642968777,0.0517905548554169,-0.0527404271637822,0.0551282730880196,0.0719224805343561,-0.0192796440212595,0.0824825109232372,0.0157506996073185,0.00809769502120083,0.173558047949595,-0.0416842371664472,-0.011175038305827,0.173044315986619,0.0545452185390161,0.0143980395857439,-0.115124960721337,-0.0603713840769686,0.0680565046243051,0.0653655002506603,0.0792509198065434,-0.0229509554253147,0.0630772869661786,0.0149777012180239,0.0624219386229299,-0.0379283814288983,-0.0271161557464502,0.0115933432367414,0.0682014418032149,0.0321562629003806,0.0313961284839146,0.0434533138773658,0.0562923477484016,-0.0190461455189929,0.0189675781881742,-0.00492511291925313,-0.0054905861228941,0.115700803087323,0.0507970783276477,0.00156592092620067,0.184215791257089,0.0228589906531755,-0.04774593133075,0.0578167157748799,0.0375041673828092,0.0343084437915302,0.0543758139385677,0.0974907640608165,-0.00748310506246297,-0.196819898267136,0.0475513214966405,-0.111334726951425,0.120083581114259,-0.0359517806571058,0.0677301673589881,0.0747937572828705,-0.0816923145785147,0.0532073447698567,0.00519874549192267,-0.0467931834737155,-0.00875324993587601,0.0279228310896005,0.0202127107477306,0.0285932337635717,0.0679550717968347,-0.0708159462460153,-0.0140683027209009,0.216149964728136,-0.00325856963315529,0.0970806030175875,0.122075127529166,0.0853584896875388,-0.09088327215735,-0.0203730195731433,0.0538264019376831,0.0264287359186153,-0.00709957427520069,-0.00963544373966707,0.00456148805465628,0.112098721111035,-0.0543710836978513,0.0530058167931737,-0.0169475888643144,0.0476442876118774,-0.0554301494223973,0.0395561804535702,0.018846733621068,-0.0372481830070648,-0.0983115432800314,0.0159581824379518,0.0493079930986309,-0.250657006226672,-0.0199331375812364,-0.111755470372123,0.19045541827516,0.0350665793248732]]},"evals":[],"jsHooks":[]}</script>
</div>
<p>Now, instead of looking at monthly returns, let’s look at how $1
would have grown in this portfolio.</p>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Add the wealth.index = TRUE argument and, instead of monthly returns,</span></span>
<span><span class='co'># the function will return the growth of $1 invested in the portfolio.</span></span>
<span><span class='va'>dollar_growth</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/PerformanceAnalytics/man/Return.portfolio.html'>Return.portfolio</a></span><span class='op'>(</span><span class='va'>merged_returns</span>, weights <span class='op'>=</span> <span class='va'>w</span>, </span>
<span>                                  wealth.index <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Use dygraphs to chart the growth of $1 in the portfolio.</span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/dygraphs/man/dygraph.html'>dygraph</a></span><span class='op'>(</span><span class='va'>dollar_growth</span>, main <span class='op'>=</span> <span class='st'>"Growth of $1 Invested in Portfolio"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/dygraphs/man/dyAxis.html'>dyAxis</a></span><span class='op'>(</span><span class='st'>"y"</span>, label <span class='op'>=</span> <span class='st'>"$"</span><span class='op'>)</span></span></code></pre>
</div>
<div id="htmlwidget-6e8228581aa3e4de6c04" style="width:624px;height:384px;" class="dygraphs html-widget"></div>
<script type="application/json" data-for="htmlwidget-6e8228581aa3e4de6c04">{"x":{"attrs":{"axes":{"x":{"pixelsPerLabel":60},"y":[]},"title":"Growth of $1 Invested in Portfolio","labels":["month","portfolio.wealthindex"],"legend":"auto","retainDateWindow":false,"ylabel":"$"},"scale":"monthly","annotations":[],"shadings":[],"events":[],"format":"date","data":[["2010-01-29T00:00:00.000Z","2010-02-26T00:00:00.000Z","2010-03-31T00:00:00.000Z","2010-04-30T00:00:00.000Z","2010-05-28T00:00:00.000Z","2010-06-30T00:00:00.000Z","2010-07-30T00:00:00.000Z","2010-08-31T00:00:00.000Z","2010-09-30T00:00:00.000Z","2010-10-29T00:00:00.000Z","2010-11-30T00:00:00.000Z","2010-12-31T00:00:00.000Z","2011-01-31T00:00:00.000Z","2011-02-28T00:00:00.000Z","2011-03-31T00:00:00.000Z","2011-04-29T00:00:00.000Z","2011-05-31T00:00:00.000Z","2011-06-30T00:00:00.000Z","2011-07-29T00:00:00.000Z","2011-08-31T00:00:00.000Z","2011-09-30T00:00:00.000Z","2011-10-31T00:00:00.000Z","2011-11-30T00:00:00.000Z","2011-12-30T00:00:00.000Z","2012-01-31T00:00:00.000Z","2012-02-29T00:00:00.000Z","2012-03-30T00:00:00.000Z","2012-04-30T00:00:00.000Z","2012-05-31T00:00:00.000Z","2012-06-29T00:00:00.000Z","2012-07-31T00:00:00.000Z","2012-08-31T00:00:00.000Z","2012-09-28T00:00:00.000Z","2012-10-31T00:00:00.000Z","2012-11-30T00:00:00.000Z","2012-12-31T00:00:00.000Z","2013-01-31T00:00:00.000Z","2013-02-28T00:00:00.000Z","2013-03-28T00:00:00.000Z","2013-04-30T00:00:00.000Z","2013-05-31T00:00:00.000Z","2013-06-28T00:00:00.000Z","2013-07-31T00:00:00.000Z","2013-08-30T00:00:00.000Z","2013-09-30T00:00:00.000Z","2013-10-31T00:00:00.000Z","2013-11-29T00:00:00.000Z","2013-12-31T00:00:00.000Z","2014-01-31T00:00:00.000Z","2014-02-28T00:00:00.000Z","2014-03-31T00:00:00.000Z","2014-04-30T00:00:00.000Z","2014-05-30T00:00:00.000Z","2014-06-30T00:00:00.000Z","2014-07-31T00:00:00.000Z","2014-08-29T00:00:00.000Z","2014-09-30T00:00:00.000Z","2014-10-31T00:00:00.000Z","2014-11-28T00:00:00.000Z","2014-12-31T00:00:00.000Z","2015-01-30T00:00:00.000Z","2015-02-27T00:00:00.000Z","2015-03-31T00:00:00.000Z","2015-04-30T00:00:00.000Z","2015-05-29T00:00:00.000Z","2015-06-30T00:00:00.000Z","2015-07-31T00:00:00.000Z","2015-08-31T00:00:00.000Z","2015-09-30T00:00:00.000Z","2015-10-30T00:00:00.000Z","2015-11-30T00:00:00.000Z","2015-12-31T00:00:00.000Z","2016-01-29T00:00:00.000Z","2016-02-29T00:00:00.000Z","2016-03-31T00:00:00.000Z","2016-04-29T00:00:00.000Z","2016-05-31T00:00:00.000Z","2016-06-30T00:00:00.000Z","2016-07-29T00:00:00.000Z","2016-08-31T00:00:00.000Z","2016-09-30T00:00:00.000Z","2016-10-31T00:00:00.000Z","2016-11-30T00:00:00.000Z","2016-12-30T00:00:00.000Z","2017-01-31T00:00:00.000Z","2017-02-28T00:00:00.000Z","2017-03-31T00:00:00.000Z","2017-04-28T00:00:00.000Z","2017-05-31T00:00:00.000Z","2017-06-30T00:00:00.000Z","2017-07-31T00:00:00.000Z","2017-08-31T00:00:00.000Z","2017-09-29T00:00:00.000Z","2017-10-31T00:00:00.000Z","2017-11-30T00:00:00.000Z","2017-12-29T00:00:00.000Z","2018-01-31T00:00:00.000Z","2018-02-28T00:00:00.000Z","2018-03-29T00:00:00.000Z","2018-04-30T00:00:00.000Z","2018-05-31T00:00:00.000Z","2018-06-29T00:00:00.000Z","2018-07-31T00:00:00.000Z","2018-08-31T00:00:00.000Z","2018-09-28T00:00:00.000Z","2018-10-31T00:00:00.000Z","2018-11-30T00:00:00.000Z","2018-12-31T00:00:00.000Z","2019-01-31T00:00:00.000Z","2019-02-28T00:00:00.000Z","2019-03-29T00:00:00.000Z","2019-04-30T00:00:00.000Z","2019-05-31T00:00:00.000Z","2019-06-28T00:00:00.000Z","2019-07-31T00:00:00.000Z","2019-08-30T00:00:00.000Z","2019-09-30T00:00:00.000Z","2019-10-31T00:00:00.000Z","2019-11-29T00:00:00.000Z","2019-12-31T00:00:00.000Z","2020-01-31T00:00:00.000Z","2020-02-28T00:00:00.000Z","2020-03-31T00:00:00.000Z","2020-04-30T00:00:00.000Z","2020-05-29T00:00:00.000Z","2020-06-30T00:00:00.000Z","2020-07-31T00:00:00.000Z","2020-08-31T00:00:00.000Z","2020-09-30T00:00:00.000Z","2020-10-30T00:00:00.000Z","2020-11-30T00:00:00.000Z","2020-12-31T00:00:00.000Z","2021-01-29T00:00:00.000Z","2021-02-26T00:00:00.000Z","2021-03-31T00:00:00.000Z","2021-04-30T00:00:00.000Z","2021-05-28T00:00:00.000Z","2021-06-30T00:00:00.000Z","2021-07-30T00:00:00.000Z","2021-08-31T00:00:00.000Z","2021-09-30T00:00:00.000Z","2021-10-29T00:00:00.000Z","2021-11-30T00:00:00.000Z","2021-12-31T00:00:00.000Z","2022-01-31T00:00:00.000Z","2022-02-28T00:00:00.000Z","2022-03-31T00:00:00.000Z","2022-04-29T00:00:00.000Z","2022-05-31T00:00:00.000Z","2022-06-30T00:00:00.000Z","2022-07-29T00:00:00.000Z","2022-08-05T00:00:00.000Z"],[0.908767032843708,0.898235337376904,0.989740903164573,0.964284265779535,0.884660141134995,0.786218402780354,0.851934224649542,0.837822279149432,0.978076250461314,1.03493018728868,1.04501251779517,1.10254036470257,1.08174539906396,1.1092255152784,1.11894752747322,1.1520306212882,1.13510293263539,1.13937021678011,1.23023139989771,1.16258341563787,1.1085021520727,1.1497968054848,1.05247809304,1.01123221659011,1.07591496882402,1.04735334761234,1.16234639140718,1.22466888761262,1.08958827438771,1.15178256397788,1.18767874871414,1.25964511131265,1.31957678568405,1.22357319224299,1.28760089238423,1.30118075866163,1.37975876049221,1.40067115568486,1.39790261821521,1.37347897973028,1.46543294127178,1.48676901501075,1.577831240587,1.46710013651234,1.58062540682061,1.78409217369706,1.91232629889263,1.95560250539166,1.8248027619378,1.85460866403906,1.75225054640244,1.59884936440342,1.64517250245465,1.70338873483256,1.66329583426411,1.75070057107449,1.70515115094201,1.63894053366039,1.72382217327369,1.63290705550084,1.72292640158384,1.84684354216388,1.811237056108,1.960632436373,1.99151376891868,2.0076404400499,2.35608259580963,2.25787109010216,2.23263929418065,2.61898483368699,2.76183793379082,2.80160298569095,2.4790685520065,2.32940375230018,2.48793482954047,2.65055993426442,2.86061924705725,2.79496530222924,2.97126413065847,3.0157668370473,3.20401684945053,3.08249367627996,2.9989082976665,3.03367567089686,3.24057672561536,3.3447815627531,3.44979475444793,3.59969976872545,3.80233531989638,3.72991548808163,3.8006629517371,3.78194425753177,3.76117916687381,4.19635061703641,4.40951296802028,4.41641791665126,5.22999183768916,5.34954417222308,5.0941252035253,5.38865079253917,5.59074765383007,5.78255750546413,6.09698877647032,6.69138887075863,6.64131650482495,5.33417326598545,5.58782025387511,4.96570181165628,5.56200106794553,5.36203722553617,5.72520890420686,6.15341878938183,5.65073176590631,5.95139219917687,5.982331972543,5.70239961495112,5.65248508588721,5.81031847217693,5.92776075880724,6.09725460787834,6.51159398252029,6.05046929307826,5.96534945945972,7.25475953471294,7.23111939559728,7.93312082701404,8.90155756367606,9.66138107317813,8.78332314768862,8.60438033328351,9.06752316752753,9.30716634275804,9.24108942401598,9.15204742677764,9.19379438179053,10.2244069741471,9.66849488679483,10.18098135543,10.0084382691829,10.4852831806256,9.90408236718738,10.2958500365309,10.4898931795718,10.0991637186946,9.10629934767201,9.25161933399676,9.70779811626863,7.27447050339181,7.12946748201705,6.33271049006148,7.53880951526163,7.80316977714367]]},"evals":[],"jsHooks":[]}</script>
</div>
<p>A dollar would have grown quite nicely in this portfolio - about 2.5x
- fantastic.</p>
<h2 id="calculating-the-sharpe-ratio">Calculating the Sharpe Ratio</h2>
<p>Now let’s look at the risk/reward of this portfolio by calculating
the Sharpe Ratio. Briefly, the Sharpe Ratio is the mean of the excess
monthly returns above the risk-free rate, divided by the standard
deviation of the excess monthly returns above the risk-free rate. This
is the formulation of the Sharpe Ratio as of 1994; if we wished to use
the original formulation from 1966 the denominator would be the standard
deviation of portfolio monthly returns. Learn more <a
href="http://web.stanford.edu/~wfsharpe/art/sr/sr.htm">here</a>.</p>
<p>In other words, the Sharpe Ratio measures excess returns per unit of
volatility, where we take the standard deviation to represent portfolio
volatility. The Sharpe Ratio was brought to us by Bill Sharpe - arguably
the most important economist for modern investment management as the
creator of the Sharpe Ratio, CAPM and Financial Engines, a forerunner of
today’s robo-advisor movement.</p>
<p>In the code chunk below, we’ll calculate the Sharpe Ratio in two
ways.</p>
<p>First, we’ll use the Return.excess function from PerformanceAnalytics
to calculate a time series of monthly excess returns. Two arguments need
to be supplied: the time series of returns and the risk-free rate. The
function will return a time series of excess returns, and we’ll take the
mean of that time series to get the numerator of the Sharpe Ratio. Then
we’ll divide by the standard deviation of the that time series to get
the Sharpe Ratio.</p>
<p>Our second method is a bit easier. We’ll use the SharpeRatio function
in PerformanceAnalytics, for which we’ll supply two arguments: a time
series of monthly returns and risk-free rate.</p>
<p>For both methods I use a risk-free rate of .03% as the approximate
mean of the 1-month Treasury bill rate since 2010. I’ll cover a quick
way to grab this and other data via Quandl in a future post.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Method 1: use the Return.excess function from PerformanceAnalytics,</span></span>
<span><span class='co'># then calculate the Sharpe Ratio manually.</span></span>
<span><span class='va'>portfolio_excess_returns</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/PerformanceAnalytics/man/Return.excess.html'>Return.excess</a></span><span class='op'>(</span><span class='va'>portfolio_monthly_returns</span>, </span>
<span>                                          Rf <span class='op'>=</span> <span class='fl'>.0003</span><span class='op'>)</span></span>
<span><span class='va'>sharpe_ratio_manual</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>portfolio_excess_returns</span><span class='op'>)</span> <span class='op'>/</span> <span class='fu'><a href='https://rdrr.io/pkg/PerformanceAnalytics/man/StdDev.html'>StdDev</a></span><span class='op'>(</span><span class='va'>portfolio_excess_returns</span><span class='op'>)</span>, <span class='fl'>4</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># If we wanted to use the original, 1966 formulation of the Sharpe Ratio,</span></span>
<span><span class='co'># there is one small change to the code in Method 1</span></span>
<span><span class='va'>sharpe_ratio</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/PerformanceAnalytics/man/SharpeRatio.html'>SharpeRatio</a></span><span class='op'>(</span><span class='va'>portfolio_monthly_returns</span>, Rf <span class='op'>=</span> <span class='fl'>.0003</span><span class='op'>)</span>, <span class='fl'>4</span></span>
<span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>Using the Return.excess function and then dividing by the standard
deviation of excess returns, the Sharpe Ratio is
<code>sharpe_ratio_manual[,1]</code> = 0.2247.</p>
<p>Using the built in SharpeRatio function, the Sharpe Ratio is
<code>sharpe_ratio[1,]</code> = 0.2247.</p>
<p>Alright, we have built a portfolio and calculated the Sharpe Ratio -
and also set up some nice reusable chunks for data import, portfolio
construction and visualization. We haven’t done anything terribly
complex but this can serve as a useful paradigm to any collaborators,
including our future selves, who want to reproduce this work, learn from
this work, or expand upon this work.</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
<h3 id="updates-and-corrections">Corrections</h3>
<p>If you see mistakes or want to suggest changes, please <a href="https://github.com/jjallaire/reproducible-finance-with-r/issues/new">create an issue</a> on the source repository.</p>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
